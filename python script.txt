#!/bin/bash
echo "Starting script ..."
user = 'myuser'
projectDir = 'MyApp'
supervisorapp = 'app'
echo "Switching to user..."
sudo -u $user bash << EOF
echo "In"
echo "Switching to project directory..."
cd "/home/$user/$projectDir/"
echo "Activating Virtual Environment..."
source venv/bin/activate
echo "Pull latest code from branch passed as argument..."
git pull origin $1
git checkout $1
echo "Installing Requirements..."
pip install -r requirements.txt
echo "Running migrate for any database migrations..."
python manage.py migrate
echo "Running collectstatic..."
python manage.py collectstatic  <<<yes
EOF
echo "Out"
whoami
echo "Restarting app using supervisor ... "
sudo supervisorctl restart $supervisorapp